<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popit Rewards</title>
    <style>
      :root {
        --bg: #020617;
        --bg-card: #020617;
        --border: #1e293b;
        --primary: #3b82f6;
        --accent: #22c55e;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --radius: 14px;
      }

      * { box-sizing:border-box; margin:0; padding:0; }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding: 32px 16px;
        display:flex;
        justify-content:center;
    	--sb-track-color: #020617;
      	--sb-thumb-color: #3b82f6;
      	--sb-size: 10px;
      }
        
        body::-webkit-scrollbar {
          width: var(--sb-size);
        }
        
        body::-webkit-scrollbar-track {
          background: var(--sb-track-color);
          border-radius: 6px;
        }
        
        body::-webkit-scrollbar-thumb {
          background: var(--sb-thumb-color);
          border-radius: 6px;
          border: 3px solid #232E33;
        }
        
        @supports not selector(::-webkit-scrollbar) {
          body {
              scrollbar-color: var(--sb-thumb-color)
                             var(--sb-track-color);
          }
        }

      .wrap {
        width: 100%;
        max-width: 720px;
      }

      .header {
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .header p {
        font-size: 0.9rem;
        color: var(--muted);
      }

      .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px 18px;
        box-shadow: 0 14px 35px rgba(15,23,42,0.5);
        margin-bottom: 14px;
      }

      .label {
        display:block;
        font-size:0.8rem;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:6px;
      }

      .row {
        display:flex;
        gap:10px;
      }

      input#address {
        flex:1;
        padding:10px 12px;
        border-radius:10px;
        border:1px solid var(--border);
        background:#020617;
        color:var(--text);
        font-size:0.9rem;
        outline:none;
      }

      input#address::placeholder { color:#64748b; }

      input#address:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
      }

      button#loadBtn {
        padding:10px 16px;
        border-radius:10px;
        border:none;
        background:var(--primary);
        color:white;
        font-size:0.85rem;
        font-weight:600;
        cursor:pointer;
        white-space:nowrap;
      }

      button#loadBtn:disabled {
        opacity:0.6;
        cursor:default;
      }

      .info {
        margin-top:10px;
        padding:8px 10px;
        border-radius:10px;
        font-size:0.8rem;
        display:flex;
        flex-direction:column;
        gap:2px;
      }

      .info-warning {
        background:rgba(250,204,21,0.05);
        border:1px solid rgba(250,204,21,0.7);
        color:#fef9c3;
      }

      .loading {
        margin-top:10px;
        font-size:0.85rem;
        color:var(--muted);
        display:flex;
        align-items:center;
        gap:8px;
      }

      .spinner {
        width:18px;
        height:18px;
        border-radius:50%;
        border:2px solid rgba(148,163,184,0.4);
        border-top-color:var(--primary);
        animation:spin 0.8s linear infinite;
      }

      @keyframes spin { to { transform:rotate(360deg); } }

      .stats {
        display:flex;
        gap:10px;
      }

      .stat {
        flex:1;
        padding:8px 10px;
        border-radius:10px;
        border:1px solid #111827;
        background:#020617;
      }

      .stat-label {
        font-size:0.75rem;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:4px;
      }

      .stat-value {
        font-size:1.4rem;
        font-weight:600;
      }

      .stat-note {
        font-size:0.75rem;
        color:var(--muted);
        margin-top:2px;
      }

      .list-header {
        margin-bottom:8px;
      }

      .list-title {
        font-size:0.95rem;
        font-weight:600;
      }

      .list-subtitle {
        font-size:0.8rem;
        color:var(--muted);
      }

      .list { margin-top:6px; }

      .empty {
        text-align:center;
        font-size:0.85rem;
        color:var(--muted);
        padding:16px 0;
      }

      .tap-card {
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:10px;
        padding:8px 10px;
        border-radius:10px;
        border:1px solid var(--border);
        margin-bottom:6px;
      }

      .tap-meta {
        flex:1;
        min-width:0;
      }

      .tap-time {
        font-size:0.8rem;
        color:#60a5fa;
        margin-bottom:3px;
      }

      .tap-src {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size:0.78rem;
        color:var(--muted);
        word-break:break-all;
      }

      .tap-amount {
        font-size:1rem;
        font-weight:600;
        color:var(--accent);
        white-space:nowrap;
      }

      .tap-amount span {
        margin-left:3px;
        font-size:0.75rem;
        color:var(--muted);
      }

      @media (max-width:600px){
        body {
          padding: 16px 12px;
        }

        .header h1 {
          font-size: 1.4rem;
        }

        .header p {
          font-size: 0.85rem;
        }

        .card {
          padding: 14px;
        }

        .row {
          flex-direction: column;
          gap: 8px;
        }

        input#address {
          font-size: 0.95rem;
          padding: 12px;
        }

        button#loadBtn {
          width: 100%;
          padding: 12px;
          font-size: 0.9rem;
        }

        .stats {
          flex-direction: column;
          gap: 8px;
        }

        .stat-value {
          font-size: 1.25rem;
        }

        .tap-card {
          flex-direction: column;
          align-items: flex-start;
          gap: 6px;
        }

        .tap-amount {
          align-self: flex-end;
          font-size: 1.05rem;
        }

        .tap-src {
          font-size: 0.75rem;
        }
      }

      @media (max-width:380px){
        .header h1 {
          font-size: 1.25rem;
        }

        .stat-value {
          font-size: 1.15rem;
        }
      }

    </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <h1>Popit Rewards</h1>
    </header>

    <section class="card">
      <label for="address" class="label">Wallet address</label>
      <div class="row">
        <input id="address"  placeholder="Example: 0:axxx...." />
        <button id="loadBtn" onclick="load()">Load</button>
      </div>

     

      <div id="loading" class="loading" style="display:none">
        <div class="spinner"></div>
        <span id="status">Loadingâ€¦</span>
      </div>
    </section>

    <section id="stats" class="card stats" style="display:none">
      <div class="stat">
        <div class="stat-label">Total balance</div>
        <div class="stat-value" id="balance">0</div>
        <div class="stat-note">NACKL</div>
      </div>
      <div class="stat">
        <div class="stat-label">Recent Popits</div>
        <div class="stat-value" id="taps">0</div>
     
      </div>
      <div class="stat">
        <div class="stat-label">Recent rewards</div>
        <div class="stat-value" id="recentRewards">0</div>
        <div class="stat-note">NACKL</div>
      </div>
    </section>

    <section class="card">
      <div class="list-header">
        <div class="list-title">Reward stream</div>
        <div class="list-subtitle">Newest first (last 24 hours)</div>
      </div>
      <div id="tapsList" class="list">
        <div class="empty">No data yet. Enter an address and press Load.</div>
      </div>
    </section>
  </div>

  <script>
    const API = 'https://corsproxy.io/?https://mainnet.ackinacki.org/graphql';
    
    async function load() {
        const addr = document.getElementById('address').value.trim();
        if (!addr) return alert('Enter address');
        
        const btn = document.getElementById('loadBtn');
        btn.disabled = true;
        
        document.getElementById('loading').style.display = 'flex';
        document.getElementById('stats').style.display = 'none';
       
        document.getElementById('tapsList').innerHTML = '<div class="empty">Loading...</div>';
        
        try {
       
            const balRes = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    query: `query($a:String!){blockchain{account(address:$a){info{balance_other{currency value}}}}}`,
                    variables: {a: addr}
                })
            }).then(r => r.json());
            
            if (!balRes.data || !balRes.data.blockchain) {
                throw new Error('Invalid response from GraphQL');
            }
            
            const nackl = balRes.data.blockchain.account?.info?.balance_other?.find(b => b.currency === 1);
            document.getElementById('balance').textContent = nackl ? (parseInt(nackl.value, 16) / 1e9).toFixed(2) : '0.00';
            

const taps = [];
let hasNextPage = true;
let cursor = null;
let totalFetched = 0;

while (hasNextPage) {
    const msgRes = await fetch(API, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            query: `query($a:String!, $after:String){
                blockchain{
                    account(address:$a){
                        messages(first:50, msg_type:[IntIn], after:$after){
                            edges{
                                node{
                                    id
                                    created_at
                                    src
                                    value_other{currency value}
                                    body
                                }
                            }
                            pageInfo{
                                endCursor
                                hasNextPage
                            }
                        }
                    }
                }
            }`,
            variables: {a: addr, after: cursor}
        })
    }).then(r => r.json());
    
    const messages = msgRes.data.blockchain.account.messages;
    const edges = messages?.edges || [];
    

    edges.forEach(({node}) => {
        if (node.body === null && node.value_other) {
            const reward = node.value_other.find(v => v.currency === 1);
            if (reward) {
                taps.push({
                    id: node.id,
                    src: node.src,
                    reward: parseInt(reward.value, 16) / 1e9,
                    timestamp: node.created_at,
                    time: new Date(node.created_at * 1000).toLocaleString('it-IT', {
                        day: '2-digit', month: '2-digit', year: 'numeric',
                        hour: '2-digit', minute: '2-digit', second: '2-digit'
                    })
                });
            }
        }
    });
    
    hasNextPage = messages.pageInfo?.hasNextPage || false;
    cursor = messages.pageInfo?.endCursor || null;
}



            taps.sort((a, b) => b.timestamp - a.timestamp);
   
            document.getElementById('taps').textContent = taps.length;
            document.getElementById('recentRewards').textContent = taps.reduce((s, t) => s + t.reward, 0).toFixed(2);
            document.getElementById('stats').style.display = 'flex';
            
            
            if (taps.length === 0) {
                document.getElementById('tapsList').innerHTML = '<div class="empty">No reward messages found</div>';
            } else {
                document.getElementById('tapsList').innerHTML = taps.map(t => `
                    <div class="tap-card">
                        <div class="tap-meta">
                            <div class="tap-time">${t.time}</div>
                            <div class="tap-src">${t.src}</div>
                        </div>
                        <div class="tap-amount">${t.reward.toFixed(4)} <span>NACKL</span></div>
                    </div>
                `).join('');
            }
            

            
        } catch (e) {

            document.getElementById('tapsList').innerHTML = `<div class="empty" style="color:#f87171">Error: ${e.message}</div>`;
        } finally {
            document.getElementById('loading').style.display = 'none';
            btn.disabled = false;
        }
    }
    
    document.getElementById('address').addEventListener('keypress', e => {
        if (e.key === 'Enter') load();
    });
</script>

</body>
</html>
