<!DOCTYPE html>
<html>
<head>
<link rel="icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popit Rewards</title>
    <style>
      :root {
            --bg: #101010;
    --bg-card: #101010;
    --border: #6b6b6b;
    --primary: #3b82f6;
    --accent: #2cff7a;
    --text: #e5e7eb;
    --muted: #e3e3e3;
    --radius: 14px;
      }

      * { box-sizing:border-box; margin:0; padding:0; }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding: 32px 16px;
        display:flex;
        justify-content:center;
	--sb-track-color: #020617;
  	--sb-thumb-color: #3b82f6;
  	--sb-size: 10px;
      }

	body::-webkit-scrollbar {
	  width: var(--sb-size);
	}
	
	body::-webkit-scrollbar-track {
	  background: var(--sb-track-color);
	  border-radius: 6px;
	}
	
	body::-webkit-scrollbar-thumb {
	  background: var(--sb-thumb-color);
	  border-radius: 6px;
	  border: 3px solid #232E33;
	}
	
	@supports not selector(::-webkit-scrollbar) {
	  body {
	      scrollbar-color: var(--sb-thumb-color)
	                     var(--sb-track-color);
	  }
	}

      .wrap {
        width: 100%;
        max-width: 720px;
      }

      .header {
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .header p {
        font-size: 0.9rem;
        color: var(--muted);
      }


      .card {
        background: var(--bg-card);
        border: 2px solid var(--border);
        border-radius: var(--radius);
        padding: 16px 18px;
        box-shadow: 0 14px 35px rgba(15,23,42,0.5);
        margin-bottom: 14px;
      }

      #balance,#recentRewards{color: var(--accent);}
      .label {
        display:block;
        font-size:0.8rem;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:6px;
      }

      .row {
        display:flex;
        gap:10px;
      }

      input#address {
        flex:1;
        padding:10px 12px;
        border-radius:10px;
        border:1px solid var(--border);
        color:var(--text);
        font-size:0.9rem;
        outline:none;
        background: var(--bg)
      }

      input#address::placeholder { color:#64748b; }

      input#address:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 1px rgba(59,130,246,0.5);
      }

      button#loadBtn {
        padding:10px 16px;
        border-radius:10px;
        border:none;
        background:var(--primary);
        color:white;
        font-size:0.85rem;
        font-weight:600;
        cursor:pointer;
        white-space:nowrap;
      }

      button#loadBtn:disabled {
        opacity:0.6;
        cursor:default;
      }

      .info {
        margin-top:10px;
        padding:8px 10px;
        border-radius:10px;
        font-size:0.8rem;
        display:flex;
        flex-direction:column;
        gap:2px;
      }

      .info-warning {
        background:rgba(250,204,21,0.05);
        border:1px solid rgba(250,204,21,0.7);
        color:#fef9c3;
      }

      .loading {
        margin-top:10px;
        font-size:0.85rem;
        color:var(--muted);
        display:flex;
        align-items:center;
        gap:8px;
      }

      .spinner {
        width:18px;
        height:18px;
        border-radius:50%;
        border:2px solid rgba(148,163,184,0.4);
        border-top-color:var(--primary);
        animation:spin 0.8s linear infinite;
      }

      @keyframes spin { to { transform:rotate(360deg); } }

      .stats {
        display:flex;
        gap:10px;
      }

      .stat {
        flex:1;
        padding:8px 10px;
        border-radius:10px;
        border:1px solid var(--border);
        background: var(--bg)
     
      }

      .stat-label {
        font-size:0.75rem;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:4px;
      }

      .stat-value {
        font-size:1.4rem;
        font-weight:600;
      }

      .stat-note {
        font-size:0.75rem;
        color:white;
        margin-top:2px;
        font-weight: bold;
      }

      .list-header {
        margin-bottom:8px;
      }

      .list-title {
        font-size:0.95rem;
        font-weight:600;
      }

      .list-subtitle {
        font-size:0.8rem;
        color:var(--muted);
      }

      .list { margin-top:6px; }

      .empty {
        text-align:center;
        font-size:0.85rem;
        color:var(--muted);
        padding:16px 0;
      }

      .tap-card {
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:10px;
        padding:8px 10px;
        border-radius:10px;
        border:1px solid var(--border);
        margin-bottom:6px;
      }

      .tap-meta {
        flex:1;
        min-width:0;
      }

      .tap-time {
        font-size:0.8rem;
        color:#60a5fa;
        margin-bottom:3px;
      }
      .tap-src-header{
		color:white; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
		        font-size:0.78rem;
		}
      .tap-src {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size:0.78rem;
        color:var(--muted);
        word-break:break-all;
      }

      .tap-amount {
        font-size:1rem;
        font-weight:600;
        color:var(--accent);
        white-space:nowrap;
      }

      .tap-amount span {
        margin-left:3px;
        font-size:0.75rem;
        color:var(--muted);
      }

 .info-btn {
    
   background: var(--bg);
    border: 2px solid var(--border);
    color: var(--text);
    padding: 3px 7px;
    border-radius: 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(1px);
    border-radius: 8px;
    margin: 0% 11px;
    }

    .info-btn:hover {
      background: rgba(59, 130, 246, 0.3);
      border-color: var(--primary);
     
    }

    .info-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg);
      border: 2px solid var(--text);
      border-radius: var(--radius);
      padding: 24px;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      z-index: 1000;
      backdrop-filter: blur(20px);
	  width: 100%;
    }

    .info-popup.active {
      display: block;
      animation: popupSlideIn 0.3s ease-out;
    }

    @keyframes popupSlideIn {
      from {
        opacity: 0;
        transform: translate(-50%, -60%) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .popup-close {
      position: absolute;
      top: 12px;
      right: 16px;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 1.4rem;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .popup-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }

    .popup-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text);
    }

    .popup-steps {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .popup-step {
          padding: 12px;
    background: var(--bg);
    border-left: 2px solid var(--text) border-radius: 6px;
    font-size: 0.95rem;
    }
		.popup-step a{
			color:white
		}

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      backdrop-filter: blur(4px);
    }

    .popup-overlay.active {
      display: block;
    }
	.container-header{
	    display: flex;
	    align-items: flex-end;
	    flex-direction: row;
	    flex-wrap: nowrap;
	    justify-content: flex-start;
	    padding: 10px 4px;
	}

      @media (max-width:600px){
        body {
          padding: 16px 12px;
        }

        .header h1 {
          font-size: 1.4rem;
        }
		 
	        .header p {
	          font-size: 0.85rem;
	        }
	
	        .card {
	          padding: 14px;
	        }
	
	        .row {
	          flex-direction: column;
	          gap: 8px;
	        }
	
	        input#address {
	          font-size: 0.95rem;
	          padding: 12px;
	        }
	
	        button#loadBtn {
	          width: 100%;
	          padding: 12px;
	          font-size: 0.9rem;
	        }
	
	        .stats {
	          flex-direction: column;
	          gap: 8px;
	        }
	
	        .stat-value {
	          font-size: 1.25rem;
	        }
	
	        .tap-card {
	          flex-direction: column;
	          align-items: flex-start;
	          gap: 6px;
	        }
	
	        .tap-amount {
	          align-self: flex-end;
	          font-size: 1.05rem;
	        }
	
	        .tap-src {
	          font-size: 0.75rem;
	        }
      }

      @media (max-width:380px){
        .header h1 {
          font-size: 1.25rem;
        }

        .stat-value {
          font-size: 1.15rem;
        }
      }

    </style>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <h1>Popit Rewards</h1>
    </header>

     <section class="card">
      <div class="container-header">
    	  <label for="address" class="label">Wallet address</label>
	  	  <button type="button" id="infoBtn" class="info-btn" title="How to find your wallet address">i</button>
	 </div>
      <div style="position: relative;">
        <div class="row">
          <input id="address" placeholder="Example: 0axxx...." />
          <button id="loadBtn" onclick="load()">Load</button>
        </div>
      </div>

      

      <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <span id="status">Loading...</span>
      </div>
    </section>

    <!-- POPUP INFORMATIVO -->
    <div id="popupOverlay" class="popup-overlay"></div>
    <div id="infoPopup" class="info-popup">
      <button id="popupClose" class="popup-close">&times;</button>
      <div class="popup-title">How to find your POPIT GAME wallet address</div>
      <div class="popup-steps">
        <div class="popup-step">
          <strong>1.</strong> Go to <a href="https://acki.live" target="_blank">acki.live</a>
        </div>
        <div class="popup-step">
          <strong>2.</strong> Search for your wallet name in the search bar
        </div>
        <div class="popup-step">
          <strong>3.</strong> Copy the wallet address from the <strong>"POPIT GAME"</strong> section
        </div>
      </div>
    </div>

    <section id="stats" class="card stats" style="display:none">
      <div class="stat">
        <div class="stat-label">Total balance</div>
        <div class="stat-value" id="balance">0</div>
        <div class="stat-note">NACKL</div>
      </div>
      <div class="stat">
        <div class="stat-label">Recent Popits</div>
        <div class="stat-value" id="taps">0</div>
     
      </div>
      <div class="stat">
        <div class="stat-label">Recent rewards</div>
        <div class="stat-value" id="recentRewards">0</div>
        <div class="stat-note">NACKL</div>
      </div>
    </section>

    <section class="card">
      <div class="list-header">
        <div class="list-title">Reward stream</div>
        <div class="list-subtitle">Newest first (last 24 hours)</div>
      </div>
      <div id="tapsList" class="list">
        <div class="empty">No data yet. Enter an address and press Load.</div>
      </div>
    </section>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  let telegramInitData = null;

  document.addEventListener('DOMContentLoaded', function() {
    if (window.Telegram && window.Telegram.WebApp) {
      Telegram.WebApp.ready();
      telegramInitData = Telegram.WebApp.initData;
    }

    // tutto il tuo codice popup infoBtn / overlay ecc. qui sotto (uguale)
    const infoBtn = document.getElementById('infoBtn');
    const popup = document.getElementById('infoPopup');
    const overlay = document.getElementById('popupOverlay');
    const closeBtn = document.getElementById('popupClose');

    infoBtn.addEventListener('click', function() {
      popup.classList.add('active');
      overlay.classList.add('active');
    });

    function closePopup() {
      popup.classList.remove('active');
      overlay.classList.remove('active');
    }

    closeBtn.addEventListener('click', closePopup);
    overlay.addEventListener('click', closePopup);
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && popup.classList.contains('active')) {
        closePopup();
      }
    });
  });

  async function load() {
    const addr = document.getElementById('address').value.trim();
    if (!addr) return alert('Enter address');

    const btn = document.getElementById('loadBtn');
    btn.disabled = true;
    document.getElementById('loading').style.display = 'flex';
    document.getElementById('stats').style.display = 'none';
    document.getElementById('tapsList').innerHTML = '<div class="empty">Loading...</div>';

    try {
      const res = await fetch(`/reward?address=${encodeURIComponent(addr)}`, {
        headers: {
          'X-Telegram-Init-Data': telegramInitData || ''
        }
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'API error');

      document.getElementById('balance').textContent = data.balance.toFixed(2);
      document.getElementById('taps').textContent = data.tapsCount;
      document.getElementById('recentRewards').textContent =
        "+" + data.totalReward.toFixed(2);
      document.getElementById('stats').style.display = 'flex';

      const taps = data.taps;
      if (!taps.length) {
        document.getElementById('tapsList').innerHTML =
          '<div class="empty">No reward messages found</div>';
      } else {
        document.getElementById('tapsList').innerHTML = taps.map(t => `
          <div class="tap-card">
            <div class="tap-meta">
              <div class="tap-time">${new Date(t.timestamp * 1000).toLocaleString('it-IT', {
                day: '2-digit', month: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
              })}</div>
              <div class="tap-src">
                ${t.src}
                ${t.is_popit
                  ? '<span style="color:#22c55e;font-size:11px;margin-left:6px;">[POPIT]</span>'
                  : ''
                }
              </div>
            </div>
            <div class="tap-amount">
              ${t.reward.toFixed(4)} <span>NACKL</span>
            </div>
          </div>
        `).join('');
      }
    } catch (e) {
      document.getElementById('tapsList').innerHTML =
        `<div class="empty" style="color:#f87171">Error: ${e.message}</div>`;
    } finally {
      document.getElementById('loading').style.display = 'none';
      btn.disabled = false;
    }
  }

  document.getElementById('address').addEventListener('keypress', e => {
    if (e.key === 'Enter') load();
  });
</script>


</body>
</html>
